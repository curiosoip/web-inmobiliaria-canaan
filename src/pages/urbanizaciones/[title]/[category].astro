---
// src/pages/[title]/[category].astro

import MainLayout from "../../../layouts/MainLayout.astro";
import FooterSection from "../../../sections/FooterSection.astro";
import SelectDepartament from "../../../components/SelectDepartament.astro";
import UrbanizacionesSection from "../../../sections/UrbanizacionesSection.astro";
import NavbarComponent from "../../../components/NavbarComponent.vue";
import ViviendasSection from "../../../sections/ViviendasSection.astro";

import SelectTypeComponent from "../../../components/SelectTypeComponent.astro";
const { title, category } = Astro.params;

let departamentos: any[] = [];

try {
  const res = await fetch("https://canaan-inmobiliaria-admin.up.railway.app/api/departamentos/");
  if (res.ok) {
    departamentos = await res.json();
  } else {
    console.error("Error al obtener departamentos");
  }
} catch (err) {
  console.error("Error:", err);
}


export async function getStaticPaths() {
  const pages = [
    { title: "lapaz", category: "lotes" },
    { title: "lapaz", category: "viviendas" },
    { title: "cochabamba", category: "lotes" },
    { title: "cochabamba", category: "viviendas" },
    { title: "santacruz", category: "lotes" },
    { title: "santacruz", category: "viviendas" },
  ];

  return pages.map((item) => ({
    params: {
      title: item.title,
      category: item.category, 
    },
  }));
}



function slugify(text: string) {
  return text
    ?.toLowerCase()
    .normalize('NFD')
    .replace(/[\u0300-\u036f]/g, '')
    .replace(/\s+/g, '')
    .replace(/[^a-z0-9]/g, '');
}

const departamentoActual = departamentos.find(
  (dep) => slugify(dep.nombre) === title
);



---

<MainLayout>
  <NavbarComponent client:load />

  <section
    id="servicios"
    class="flex bg-slate-900 flex-col w-full justify-center py-2 px-3 md:px-4 border-b-2 border-slate-400/10 items-center overflow-hidden"
  >
    <div class="w-full flex justify-between items-center max-w-8xl mx-auto">
      <h1
        class="font-bold flex flex-col md:flex-row w-full justify-start items-start lg:items-center md:gap-1"
      >
        <span class="block text-2xs lg:text-xs text-slate-100 px-2 py-1 bg-slate-800 rounded-full sm:mt-1 lg:ml-10">Urbanizaciones y Viviendas</span>
        <span class="block text-xl text-amber-400 px-2">Disponibles</span>
      </h1>
      <div class="w-[40vh] z-20">
        <SelectDepartament departamentos={departamentos} active={true} />
      </div>
    </div>
  </section>
  <div class="relative z-10 flex pt-10 w-full justify-center items-center flex-col text-center mb-6 sm:mb-16 lg:mb-20">
      <h2 class="text-3xl sm:text-4xl lg:text-5xl xl:text-6xl font-bold max-w-3xl text-slate-800 mb-4 sm:mb-6 tracking-tight">
        ENCUENTRA TU LUGAR IDEAL EN <strong class="text-amber-400">{title=="lapaz"?"LA PAZ":title=="cochabamba"?"COCHABAMBA":"SANTA CRUZ"}</strong>
      </h2>
      <p class="text-lg sm:text-xl text-gray-600 max-w-3xl mx-auto px-4">
        Lotes urbanizados y viviendas en <strong>las mejores zonas de {title=="lapaz"?"La Paz":title=="cochabamba"?"Cochabamba":"Santa Cruz"}</strong>  con servicios b√°sicos y financiamiento accesible
      </p>
  </div>
  <div class="flex w-full border border-gray-300 justify-between items-center mb-10 pl-2 pr-4 py-1 rounded-full max-w-6xl mx-auto">
    <SelectTypeComponent departamentos={departamentos} active={true} />
    <h1 class="text-md font-bold text-slate-700">25 Urbanizaciones</h1>
  </div>

  {category === "lotes" && <UrbanizacionesSection urbanizaciones={departamentoActual.urbanizaciones} />}
  {category === "viviendas" && <ViviendasSection viviendas={departamentoActual.viviendas}  />}

  
  <FooterSection />
</MainLayout>
